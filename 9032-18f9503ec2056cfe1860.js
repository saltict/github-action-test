"use strict";(("undefined"!=typeof self?self:this).webpackChunk_subwallet_webapp=("undefined"!=typeof self?self:this).webpackChunk_subwallet_webapp||[]).push([[9032],{52274:(e,n,t)=>{t.d(n,{nC:()=>h,x1:()=>g.x1,b_:()=>g.b_,bO:()=>r});var a=t(80949),i=t(54533);const o="RMRK",s="SEND";function r(e,n){return e.type===a.Ym.ERC721?function(e){return{contractAddress:e.collectionId,tokenId:parseInt(e.id)}}(e):e.type===a.Ym.PSP34?function(e){return{contractAddress:e.collectionId,onChainOption:e.onChainOption,isPsp34:!0,networkKey:e.chain}}(e):i.r$.acala.includes(n)||i.r$.karura.includes(n)||i.r$.bitcountry.includes(n)?function(e){return{collectionId:parseInt(e.collectionId),itemId:parseInt(e.id),networkKey:e.chain}}(e):i.r$.rmrk.includes(n)?function(e){return e.rmrk_ver?{remark:`${o}::${s}::${e.rmrk_ver}::${e.id}::`,networkKey:e.chain}:{}}(e):i.r$.statemine.includes(n)||i.r$.unique_network.includes(n)?function(e){return{collectionId:parseInt(e.collectionId),itemId:parseInt(e.id),networkKey:e.chain}}(e):{}}var l=t(9661),c=t(36926),m=t(95110),u=t(63910),d=t(68774);const f=(e,n)=>t=>{const a=(0,d.u)(t.address),i=t.availableGenesisHashes||[];if(t.isHardware){if(a)return!1;if(n&&!i.includes((0,c.zb)(n)))return!1}return!((0,u.W_)(t.address)||t.isReadOnly||e===l.WQ.POOLED&&(0,d.u)(t.address))},h=(e,n,t)=>a=>{if(t&&t!==m.EN){const i=e[t],o=f(n,i),s=(0,c.h4)(i),r=(0,d.u)(a.address);return o(a)&&s===r}return f(n)(a)};var g=t(11164)},59032:(e,n,t)=>{t.r(n),t.d(n,{default:()=>B});var a=t(9661),i=t(54533),o=t(36926),s=t(56858),r=t(57801),l=t(43557),c=t(52274),m=t(13738),u=t(25690),d=t(58094),f=t(72558),h=t(72779),g=t.n(h),p=t(78166),x=t(2784),v=t(76699),N=t(82575),b=t(68714),O=t(52322);const E=(0,N.ZP)((function(e){const{className:n="",stakingType:t}=e,{t:i}=(0,v.$)(),{chain:o}=(0,x.useContext)(m.TransactionContext),{token:s}=(0,N.Fg)(),r=(0,l.aJ)(o),{decimals:h,symbol:E}=(0,l.cR)(o),k=(0,x.useMemo)((()=>t===a.WQ.POOLED?(null==r?void 0:r.minJoinNominationPool)||"0":(null==r?void 0:r.minStake)||"0"),[null==r?void 0:r.minJoinNominationPool,null==r?void 0:r.minStake,t]),_=(()=>{if(!r)return null;const{expectedReturn:e,inflation:n,maxValidatorPerNominator:o,nominatorCount:s,unstakingPeriod:l}=r;return(0,O.jsxs)(b.o,{hasBackgroundWrapper:!0,spaceSize:"xs",valueColorScheme:"light",children:[t===a.WQ.NOMINATED&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(b.o.Number,{label:i("Max nomination"),value:o,valueColorSchema:"even-odd"}),!!s&&(0,O.jsx)(b.o.Default,{label:i("Total nominators"),children:(0,O.jsx)("div",{className:"__active-nominators-value",children:(0,O.jsx)(u.Z,{className:"__current-nominator-count",decimal:0,decimalOpacity:1,intOpacity:1,unitOpacity:1,value:s})})})]}),!!e&&!!n&&(0,O.jsx)(b.o.Default,{label:i("Estimated earnings"),labelAlign:"top",children:(0,O.jsxs)("div",{className:"__active-nominators-value",children:[(0,O.jsx)(u.Z,{className:"__current-nominator-count",decimal:0,decimalOpacity:1,intOpacity:1,suffix:"%",unitOpacity:1,value:e}),(0,O.jsx)("span",{className:"__slash",children:"/"}),(0,O.jsx)(u.Z,{className:"__total-nominator-count",decimal:0,decimalOpacity:1,intOpacity:1,suffix:"%",unitOpacity:1,value:new f.Z(e).minus(n)}),(0,O.jsx)("span",{className:"__inflation",children:i("after inflation")})]})}),(0,O.jsx)(b.o.Number,{decimals:h,label:i("Minimum active"),suffix:E,value:k,valueColorSchema:"success"}),!!l&&(0,O.jsx)(b.o.Default,{label:i("Unstaking period"),children:(0,O.jsx)("span",{children:(0,c.b_)(i,l)})})]})})();return(0,O.jsxs)("div",{className:g()("network-information-container",n),children:[(0,O.jsxs)("div",{className:"title-wrapper",children:[(0,O.jsx)(d.Z,{backgroundColor:s.colorPrimary,iconColor:s.colorWhite,phosphorIcon:p.Z,size:"sm",weight:"fill"}),(0,O.jsx)("div",{className:"__title",children:i("Network Information")})]}),_]})})).withConfig({displayName:"NetworkInformation",componentId:"sc-1m06i7r-0"})((({theme:{token:e}})=>({".title-wrapper":{display:"flex",justifyContent:"start",alignItems:"center",gap:e.marginXS,marginBottom:e.marginMD+4,minHeight:40},".__title":{fontSize:e.fontSizeLG,lineHeight:e.lineHeightLG,fontWeight:e.headingFontWeight},".__current-nominator-count, .__total-nominator-count":{display:"inline-flex"},".__slash":{marginLeft:e.marginXXS,marginRight:e.marginXXS},".__inflation":{marginLeft:e.marginXXS,color:e.colorTextLight4},".__total-nominator-count":{color:e.colorTextLight4},".-to-right":{textAlign:"right"}})));var k=t(89558),_=t(75576),j=t(3612),S=t(35185),y=t(73160),I=t(63910),P=t(12798),w=t(81345),T=t(92280),M=t(99656),A=t(94344),W=t(73557),C=t(95292),L=t(62197),D=t.n(L),Z=t(68774),Q=t(94684),R=function(e){return e.VALUE="amount",e.NOMINATE="nominate",e.POOL="pool",e.TYPE="type",e}(R||{});const B=(0,N.ZP)((e=>{const{className:n}=e,{t}=(0,v.$)(),{chain:u,type:d}=(0,W.UO)(),h=(0,x.useContext)(_.R0),{isWebUI:g}=(0,x.useContext)(j.sG),{asset:p,chain:N,from:b,onDone:L,setAsset:B,setChain:F,setDisabledRightBtn:V,setFrom:$,setShowRightBtn:J}=(0,x.useContext)(m.TransactionContext),{nominationPoolInfoMap:z,validatorInfoMap:X}=(0,l.v9)((e=>e.bonding)),Y=(0,l.v9)((e=>e.chainStore.chainInfoMap)),H=(0,l.wE)(N),K=(0,l.v9)((e=>e.accountState.currentAccount)),U=function(e){const n=(0,S.v9)((e=>e.assetRegistry.assetRegistry));return(0,x.useMemo)((()=>n[e]),[n,e])}(p),G=(0,Z.u)(null==K?void 0:K.address),q=(0,x.useMemo)((()=>{if(G)return a.WQ.NOMINATED;switch(d){case a.WQ.POOLED:return a.WQ.POOLED;case a.WQ.NOMINATED:return a.WQ.NOMINATED;default:return a.WQ.POOLED}}),[d,G]),[ee]=P.Z.useForm(),[ne,te]=(0,x.useState)(!0),ae=P.Z.useWatch(R.TYPE,ee),ie=P.Z.useWatch(R.NOMINATE,ee),oe=(0,l.aJ)(N),se=(0,l._y)(N,ae,b),re=(0,x.useMemo)((()=>se[0]),[se]),{nativeTokenBalance:le}=(0,l.L5)(N,b),ce=(0,l.O_)(ae,b,u),me=(0,x.useMemo)((()=>i.H_.relay.includes(N)),[N]),[ue,de]=(0,x.useState)(!1),[fe,he]=(0,x.useState)(!1),[ge,pe]=(0,x.useState)(!1),[xe,ve]=(0,x.useState)(!0),[Ne,be]=(0,x.useState)(!1),[,Oe]=(0,x.useState)({}),[Ee,ke]=(0,x.useState)(!1),_e=(0,x.useMemo)((()=>U&&U.minAmount||"0"),[U]),je=(0,x.useMemo)((()=>{const e=new f.Z(le.value),n=new f.Z(_e);return n.gte(e)?"0":e.minus(n).toString()}),[_e,le.value]),{decimals:Se,symbol:ye}=(0,l.cR)(N),Ie=(0,I.W_)((null==K?void 0:K.address)||""),Pe=(0,l.uH)(u||""),we=(0,x.useMemo)((()=>({asset:Pe,from:b,chain:N,[R.VALUE]:"0",[R.POOL]:"",[R.NOMINATE]:"",[R.TYPE]:q})),[Pe,b,q,N]),Te=(0,x.useCallback)((e=>{const n=X[N];if(!n)return[];const t=[];return n.forEach((n=>{e.some((e=>(0,s.Wr)(e,n.address)))&&t.push(n)})),t}),[N,X]),Me=(0,x.useCallback)((e=>{let n=C.nw;return e.forEach((e=>{const t=new(D())(null==e?void 0:e.minBond);t.gt(n)&&(n=t)})),n.toString()}),[]),Ae=(0,x.useMemo)((()=>{if(ae===a.WQ.NOMINATED){const e=Te((0,I.in)(ie)),n=Me(e);return D().max(new(D())(n),new(D())((null==oe?void 0:oe.minStake)||"0")).toString()}return(null==oe?void 0:oe.minJoinNominationPool)||"0"}),[null==oe?void 0:oe.minJoinNominationPool,null==oe?void 0:oe.minStake,Te,Me,ie,ae]),We=(0,x.useMemo)((()=>ae===a.WQ.NOMINATED?(null==oe?void 0:oe.minStake)||"0":(null==oe?void 0:oe.minJoinNominationPool)||"0"),[null==oe?void 0:oe.minJoinNominationPool,null==oe?void 0:oe.minStake,ae]),{onError:Ce,onSuccess:Le}=(0,l.Ls)(L),De=(0,x.useCallback)(((e,n)=>{const{error:t}=(0,I.ij)(n),i=(0,I.eW)(n),s=(0,I.eW)(e),{amount:r,asset:l,from:c}=s;if(r&&be(!0),c&&$(c),l){const e=(0,o.QJ)(l);B(l),F(e),ee.resetFields(["nominate","pool"])}const m={},u=i[R.TYPE];for(const[e,n]of Object.entries(i))m[e]=!!n;u===a.WQ.NOMINATED?m.pool=!0:u===a.WQ.POOLED&&(m.nominate=!0),te(t||Object.values(m).some((e=>!e)))}),[ee,B,F,$]),Ze=(0,x.useCallback)((e=>{const n=z[N];for(const t of n)if(String(t.id)===e)return t}),[z,N]),Qe=(0,x.useCallback)((e=>{de(!0);const{from:n,[R.NOMINATE]:t,[R.POOL]:i,[R.VALUE]:o,[R.TYPE]:s}=e;let r;if(i&&s===a.WQ.POOLED){const e=Ze(i);r=(0,y.qgo)({amount:o,chain:N,nominatorMetadata:re,selectedPool:e,address:n})}else{const e=Te((0,I.in)(t));r=(0,y.Qxk)({amount:o,chain:N,nominatorMetadata:re,selectedValidators:e,address:n,type:a.WQ.NOMINATED})}setTimeout((()=>{r.then(Le).catch(Ce).finally((()=>{de(!1)}))}),300)}),[Ze,N,re,Te,Le,Ce]),Re=(0,x.useCallback)((()=>oe?(0,O.jsxs)(r.oB,{className:"meta-info",labelColorScheme:"gray",spaceSize:"xs",valueColorScheme:"light",children:[oe.expectedReturn&&(0,O.jsx)(r.oB.Number,{label:t("Estimated earnings:"),suffix:"% / year",value:oe.expectedReturn}),oe.minStake&&(0,O.jsx)(r.oB.Number,{decimals:Se,label:t("Minimum active:"),suffix:ye,value:Ae,valueColorSchema:"success"})]}):null),[oe,Se,ye,t,Ae]),Be=(0,l.ve)(b);return(0,x.useEffect)((()=>{const e=(null==K?void 0:K.address)||"";e&&((0,I.W_)(e)||$(e))}),[null==K?void 0:K.address,$]),(0,x.useEffect)((()=>{u&&u!==k.EN&&F(u)}),[F,u]),(0,x.useEffect)((()=>{B(Pe)}),[Pe,B]),(0,x.useEffect)((()=>{J(!0)}),[J]),(0,x.useEffect)((()=>{V(!oe)}),[oe,V]),(0,x.useEffect)((()=>{let e=!1;return(N&&b&&null!=H&&H.active||Ee)&&(0,c.x1)(N,d||k.EN,e,he,pe,ke),()=>{e=!0}}),[b,d,N,null==H?void 0:H.active,Ee]),(0,x.useEffect)((()=>{let e=!1;return Ne&&(e||setTimeout((()=>{ee.validateFields([R.VALUE]).finally((()=>Oe({})))}),100)),()=>{e=!0}}),[ee,le.value]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{className:n,children:[(0,O.jsxs)("div",{className:"__transaction-block",children:[(0,O.jsx)(Q.tc,{children:(0,O.jsxs)(r.FE,{resolve:h.awaitStores(["staking"]),children:[(0,O.jsxs)(P.Z,{className:"form-container form-space-sm",form:ee,initialValues:we,onFieldsChange:De,onFinish:Qe,children:[(0,O.jsx)(P.Z.Item,{className:"staking-type",hidden:d!==k.EN,name:R.TYPE,children:(0,O.jsx)(r.Ee,{optionType:"button",options:[{label:t("Pools"),value:a.WQ.POOLED,disabled:G},{label:t("Nominate"),value:a.WQ.NOMINATED}]})}),(0,O.jsx)(P.Z.Item,{hidden:!Ie,name:"from",children:(0,O.jsx)(r.pK,{filter:(0,c.nC)(Y,ae,u)})}),!Ie&&(0,O.jsx)(P.Z.Item,{name:"asset",children:(0,O.jsx)(r.kB,{disabled:u!==k.EN||!b,items:ce,prefixShape:"circle"})}),(0,O.jsx)(Q.ZL,{address:b,chain:N,className:"account-free-balance",label:t("Available balance:"),onBalanceReady:ve}),(0,O.jsxs)("div",{className:"form-row",children:[Ie&&(0,O.jsx)(P.Z.Item,{name:"asset",children:(0,O.jsx)(r.kB,{disabled:u!==k.EN||!b,items:ce,prefixShape:"circle"})}),(0,O.jsx)(P.Z.Item,{name:R.VALUE,rules:[{required:!0,message:t("Amount is required")},({getFieldValue:e})=>({validator:(n,i)=>{const o=e(R.TYPE),s=new f.Z(i);if(o===a.WQ.POOLED){if(s.lte(0))return Promise.reject(new Error(t("Amount must be greater than 0")))}else if((null==re||!re.isBondedBefore||!me)&&s.lte(0))return Promise.reject(new Error(t("Amount must be greater than 0")));return s.gt(le.value)?Promise.reject(t("Amount cannot exceed your balance")):Promise.resolve()}})],statusHelpAsTooltip:!0,children:(0,O.jsx)(r._Z,{decimals:N&&b?Se:-1,maxValue:je,showMaxButton:!1})})]}),(0,O.jsx)(P.Z.Item,{hidden:ae!==a.WQ.POOLED,name:R.POOL,children:(0,O.jsx)(r.Tz,{chain:N,from:b,label:t("Select pool"),loading:fe,setForceFetchValidator:ke})}),(0,O.jsx)(P.Z.Item,{hidden:ae!==a.WQ.NOMINATED,name:R.NOMINATE,children:(0,O.jsx)(r.OF,{chain:p?N:"",from:p?b:"",loading:ge,setForceFetchValidator:ke})})]}),oe&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(w.Z,{className:"staking-divider"}),Re()]})]})}),(0,O.jsx)(Q.Xd,{errors:[],warnings:[],children:(0,O.jsx)(T.Z,{disabled:ne||!xe,icon:(0,O.jsx)(M.Z,{phosphorIcon:A.Z,weight:"fill"}),loading:ue,onClick:Be(ee.submit,ae===a.WQ.POOLED?a.Vv.STAKING_JOIN_POOL:a.Vv.STAKING_BOND),children:t("Stake")})})]}),g&&(0,O.jsx)(E,{className:"__network-information-block",stakingType:ae})]}),oe&&(0,O.jsx)(r.R5,{activeNominators:oe.nominatorCount,estimatedEarning:oe.expectedReturn,inflation:oe.inflation,maxValidatorPerNominator:oe.maxValidatorPerNominator,minimumActive:{decimals:Se,value:We,symbol:ye},stakingType:ae,unstakingPeriod:oe.unstakingPeriod})]})})).withConfig({displayName:"Stake",componentId:"sc-abqz0v-0"})((({theme:{token:e}})=>({display:"flex",flex:1,".__transaction-block":{display:"flex",flexDirection:"column",flex:1},".__network-information-block":{flex:1},".staking-type":{marginBottom:e.margin},".account-free-balance":{marginBottom:e.marginXS},".meta-info":{marginTop:e.paddingSM},".react-tabs__tab-list":{marginLeft:0,marginRight:0},".staking-divider":{marginTop:e.margin+2,marginBottom:e.marginSM},".web-ui-enable &":{paddingTop:24,maxWidth:784,width:"100%",marginLeft:"auto",marginRight:"auto",gap:e.size,".__transaction-block":{display:"block",maxWidth:384,flex:1},".transaction-content":{paddingLeft:0,paddingRight:0},".transaction-footer":{paddingTop:4,paddingLeft:0,paddingRight:0,marginBottom:0},".meta-info":{marginBottom:e.marginSM}}})))}}]);